<% layout('layouts/boilerplate') %>

  <a href="/blog">All Posts</a>
  <div class="card mb-4 mx-auto">

    <div id="blogControls" class="carousel slide" data-ride="carousel">
      <div class="carousel-inner">
        <!-- set only first image uploaded to the active class -->
        <% blog.images.forEach((img,i)=> { %>
          <div class="carousel-item <%= i === 0 ? 'active' : '' %>">
            <img src="<%=img.url%>" class="d-block w-100" alt="">
          </div>
          <% }) %>
      </div>
      <!-- hide left/right buttons when there is only one image -->
      <% if(blog.images.length> 1) { %>
        <a class="carousel-control-prev" href="#blogControls" role="button" data-slide="prev">
          <span class="carousel-control-prev-icon" aria-hidden="true"></span>
          <span class="sr-only">Previous</span>
        </a>
        <a class="carousel-control-next" href="#blogControls" role="button" data-slide="next">
          <span class="carousel-control-next-icon" aria-hidden="true"></span>
          <span class="sr-only">Next</span>
        </a>
        <% } %>
    </div>

    <!-- <img src="<%#blog.images[0].url%>" class="card-img-top" alt="..."> -->
    <div class="card-body text-center">
      <h5 class="card-title">
        <%=blog.title%>
      </h5>
      <p class="card-text"><small class="text-muted">Posted <%=blog.date %> by <a
              href="/users/<%=blog.author.username%>">
              <%=blog.author.username%>
            </a></small>

        <!-- display user profile picture if it exists -->
        <% if(user.image.filename) {%>
          <img src="<%=user.image.url%>" alt="" class="img-thumbnail">
          <% } %>
      </p>
      <p class="card-text">
        <%=blog.description%>
      </p>
      <p class="card-text">
        <%-blog.text%>
      </p>

      <!-- display edit & delete buttons only if the current user matches the blog author or if you are the admin -->
      <% if(currentUser && blog.author.equals(currentUser._id) || currentUser && currentUser.username=='admin' ) {%>
        <a href="/blog/<%=blog._id%>/edit " class="btn btn-primary">Edit</a>
        <form class="d-inline" action="/blog/<%=blog._id%>?_method=DELETE" method="POST">
          <button class="btn btn-danger">Delete</button>
        </form>
        <% } %>
    </div>
  </div>


  <div class="card mb-4 mx-auto">
    <div class="card-body text-center">
      <h5>Comments</h5>
      <% if (currentUser) {%>
        <form action="/blog/<%=blog._id%>/comments/" method="POST" class="mb-3 validated-form" novalidate>
          <label class="form-label" for="body"></label>
          <textarea class="form-control tinycloud" id="" cols="80" rows="3" id="body" name="comment[body]"></textarea>
          <button class="btn btn-success mt-3">Post Comment</button>
        </form>
        <% } %>

          <% for (let comment of blog.comments) { %>
            <div class="card mb-3">
              <div class="card-body">
                <h5 class="card-title">
                  <a href="/users/<%=comment.author.username%>">
                    <%=comment.author.username%>
                  </a>
                </h5>
                <p class="card-test">
                  <small class="text-muted">
                    <%=comment.date%>
                  </small>
        <!-- display user profile picture if it exists -->
        <% if(comment.author.image.filename) {%>
          <img src="<%=comment.author.image.url%>" alt="" class="img-thumbnail">
          <% } %>
                </p>
                <p class="card-text">
                  <%-comment.body%>
                </p>
                <% if(currentUser && comment.author.equals(currentUser._id)) {%>
                  <form class="d-inline" action="/blog/<%=blog._id%>/comments/<%=comment._id%>?_method=DELETE"
                    method="POST">
                    <button class="btn btn-danger">Delete</button>
                  </form>
                  <% } %>
              </div>
            </div>

            <% } %>

    </div>
  </div>